---
title: "http"
date: 2021-08-30T20:27:54+08:00
draft: false
audthor: lihongda
categories: ["计算机网络"]
tags: ["http","https","http2"]
---

HTTP 超文本传输协议是位于 TCP/IP 体系结构中的应用层协议，它是万维网数据通信的基础。

HTTP/1.1 是目前使用最广泛的版本，一般没有特别标明版本都是指 HTTP/1.1。

HTTP 报文由请求行、首部、实体主体组成，它们之间由 CRLF（回车换行符） 分隔开。

## HTTPS

HTTPS 是最流行的 HTTP 安全形式，由网景公司首创，所有主要的浏览器和服务器都支持此协议。 使用 HTTPS 时，所有的 HTTP 请求和响应数据在发送之前，都要进行加密。加密可以使用 SSL 或 TLS。

SSL/TLS 协议作用在 HTTP 协议之下，对于上层应用来说，原来的发送/接收数据流程不变，这就很好地兼容了老的 HTTP 协议。

### HTTP/1.1 的问题

#### 1. 队头阻塞

在 HTTP 请求应答过程中，如果出现了某种情况，导致响应一直未能完成，那后面所有的请求就会一直阻塞着，这种情况叫队头阻塞。

#### 2. 低效的 TCP 利用

每个 TCP 连接在一开始的时候传输速率都不高，在处理多个请求后，才会慢慢达到“合适”的速率。对于请求数据量很小的 HTTP 请求来说，这种情况就是种灾难。

#### 3. 臃肿的消息首部

HTTP/1.1 的首部无法压缩，再加上 cookie 的存在，经常会出现首部大小比请求数据大小还大的情况。

#### 4. 受限的优先级设置

HTTP/1.1 无法为重要的资源指定优先级，每个 HTTP 请求都是一视同仁。

## HTTP/2

#### **二进制分帧**

先来理解几个概念：

**帧**：HTTP/2数据通信的最小单位。消息：指 HTTP/2 中逻辑上的 HTTP 消息，例如请求和响应等，消息由一个或多个帧组成。

**流**：存在于连接中的一个虚拟通道。流可以承载双向消息，每个流都有一个唯一的整数ID。

HTTP/2采用**二进制格式**传输数据，而非HTTP1.x的文本格式，二进制协议解析起来更高效。

HTTP/2 是基于帧的协议。采用分帧是为了将重要信息封装起来，让协议的解析方可以轻松阅读、解析并还原信息。

**HTTP/2 中，同域名下所有通信都在单个连接上完成，该连接可以承载任意数量的双向数据流**。 每个数据流都以消息的形式发送，而消息又由一个或多个帧组成,多个帧之间可以乱序发送，根据帧首部的流标识可以重新组装。

#### **多路复用**

多路复用，代替原来的序列和阻塞机制, 所有请求都是通过一个TCP连接并发完成。 HTTP 1.x 中，如果想并发多个请求，必须使用多个TCP连接，且浏览器为了控制资源，还会对单个域名有 6-8个的TCP连接请求限制。

**同个域名只需要占用一个 TCP 连接**，消除了因多个 TCP 连接而带来的延时和内存消耗。

•单个连接上可以并行交错的请求和响应，之间互不干扰。

**•在HTTP/2中，每个请求都可以带一个31bit的优先值，0表示最高优先级， 数值越大优先级越低。有了这个优先值，客户端和服务器就可以在处理不同的流时采取不同的策略，以最优的方式发送流、消息和帧。**

#### **服务器推送**

服务端可以在发送页面HTML时主动推送其它资源，而不用等到浏览器解析到相应位置，发起请求再响应。 例如服务端可以主动把JS和CSS文件推送给客户端，而不需要客户端解析HTML时再发送这些请求。

服务端可以主动推送，客户端也有权利选择是否接收。如果服务端推送的资源已经被浏览器缓存过，浏览器可以通过发送RST_STREAM帧来拒收。主动推送也遵守同源策略，服务器不会随便推送第三方资源给客户端。

#### **头部压缩**

HTTP 1.1请求的大小变得越来越大，有时甚至会大于TCP窗口的初始大小，因为它们需要等待带着ACK的响应回来以后才能继续被发送。

HTTP/2对消息头采用HPACK(专为http/2头部设计的压缩格式)进行压缩传输，能够节省消息头占用的网络的流量。而HTTP/1.x每次请求，都会携带大量冗余头信息，浪费了很多带宽资源。

为了减少这块的资源消耗并提升性能， HTTP/2对这些首部采取了压缩策略：

**•HTTP/2在客户端和服务器端使用“首部表”来跟踪和存储之前发送的键－值对，对于相同的数据，不再通过每次请求和响应发送；**

**•首部表在HTTP/2的连接存续期内始终存在，由客户端和服务器共同渐进地更新；**

**•每个新的首部键－值对要么被追加到当前表的末尾，要么替换表中之前的值。**







参考：

[HTTP HTTPS HTTP1.1 HTTP2 HTTP3 - 云+社区 - 腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/1800848)

[半小时搞懂 HTTP、HTTPS和HTTP2 - SegmentFault 思否](https://segmentfault.com/a/1190000022662058)



